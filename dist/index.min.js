// title:  White cane
// author: Misteki
// desc:   TIC test project
// script: js
// input: mouse
function log(t){var i="";Object.keys(t).forEach(function(a){i=i+a+":"+t[a]+", "}),trace("{"+i+"}")}function isPointInRect(t,i,a,e,n,r){return t>=a&&t<a+n&&i>=e&&i<e+r}function areCollidingFull(t,i){return Math.floor(t.position.x)===Math.floor(i.position.x)&&Math.floor(t.position.y)===Math.floor(i.position.y)}function getMapData(){var t={top:3,bottom:1,left:2,right:2},i={6:{type:"BEND",directions:["UP","LEFT"]},8:{type:"BEND",directions:["UP","RIGHT"]},10:{type:"BEND",directions:["DOWN","LEFT"]},12:{type:"BEND",directions:["DOWN","RIGHT"]},14:{type:"BEND",directions:["UP","LEFT","RIGHT"]},32:{type:"BEND",directions:["DOWN","LEFT","RIGHT"]},34:{type:"BEND",directions:["UP","DOWN","RIGHT"]},36:{type:"BEND",directions:["UP","DOWN","LEFT"]},64:{type:"HOME",color:"GREEN"},66:{type:"HOME",color:"BLUE"},68:{type:"HOME",color:"ORANGE"},76:{type:"SPAWNER"}};for(x=t.left;x<30-t.right;x++)for(y=t.top;y<17-t.bottom;y++){var a=i[mget(x,y)];a&&(trace("it is!"),log(a))}}function getInput(t){var i=mouse(),a=time();t.x=i[0],t.y=i[1],t.p=i[2]&&(0===t.lastClickStamp||a-t.lastClickStamp>50)?1:0,t.lastClickStamp=i[2]?a:t.lastClickStamp}function update(t,i,a){updateCursorPosition(t,i.cursor),checkBarrierClick(t,i.barrier),move(i.walkers,a),animate(i,a)}function updateCursorPosition(t,i){i.x=16*Math.floor(t.x/16),i.y=16*Math.floor((t.y+8)/16)-8}function checkBarrierClick(t,i){if(t.p&&isPointInRect(t.x,t.y,i.x,i.y,TILE_SCALE*TILE_SIZE,TILE_SCALE*TILE_SIZE)){var a=i.directions.indexOf(i.animationId);i.animationId=a+1<i.directions.length?i.directions[a+1]:i.directions[0]}}function move(t,i){t.forEach(function(t){t.x+=t.velocityX*i,t.y+=t.velocityY*i})}function animateEntity(t,i){var a=ANIMATIONS[t.type][t.animationId],e=100*i,n=t.animationTimestamp+e>=t.animationSpeed;t.animationFrameIndex=n?t.animationFrameIndex+1<a.length?t.animationFrameIndex+1:0:t.animationFrameIndex,t.animationTimestamp=n?0:t.animationTimestamp+e,t.sprite=a[t.animationFrameIndex]}function animate(t,i){t.walkers.forEach(function(t){animateEntity(t,i)}),animateEntity(t.barrier,i)}function draw(t){map(t.tilemap.x,t.tilemap.y),t.walkers.forEach(function(t){spr(t.sprite,t.x+8,t.y-8,0,1,0,0,TILE_SCALE,TILE_SCALE)}),spr(t.barrier.sprite,t.barrier.x,t.barrier.y,0,1,0,0,TILE_SCALE,TILE_SCALE);var i=isPointInRect(t.cursor.x,t.cursor.y,t.barrier.x,t.barrier.y,TILE_SCALE,TILE_SCALE)?46:44;spr(i,t.cursor.x,t.cursor.y,0,1,0,0,TILE_SCALE,TILE_SCALE)}function TIC(){var i=time();delta=(i-t)/1e3,t=i,getInput(mouseData),update(mouseData,scene,delta),draw(scene)}var TILE_SCALE=2,TILE_SIZE=8,ANIMATIONS={walker:{DOWN:[288,290,288,292],UP:[294,296,294,298],RIGHT:[300,302,300,320],LEFT:[322,324,322,326]},barrier:{DOWN:[42],RIGHT:[40]}},t=0,delta=0,mouseData={x:0,y:0,p:0,lastClickStamp:0},scene={tilemap:{x:0,y:0},walkers:[{type:"walker",x:32,y:40,velocityX:30,velocityY:0,sprite:0,animationId:"RIGHT",animationFrameIndex:0,animationSpeed:11,animationTimestamp:0}],barrier:{type:"barrier",x:112,y:40,sprite:0,directions:["RIGHT","DOWN"],animationId:"RIGHT",animationFrameIndex:0,animationSpeed:0,animationTimestamp:0},cursor:{x:0,y:0,sprite:44}};getMapData();
